/*
 * ! SAP UI development toolkit for HTML5 (SAPUI5)

		(c) Copyright 2009-2015 SAP SE. All rights reserved
	
 */
sap.ui.define(["sap/base/util/extend","sap/base/util/isPlainObject","sap/m/NavContainer","sap/suite/ui/generic/template/lib/FlexibleColumnLayoutHelper","sap/ui/core/UIComponent","sap/ui/model/base/ManagedObjectModel","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/ui/model/json/JSONModel","sap/ui/model/odata/MessageScope","sap/ui/model/resource/ResourceModel","sap/ui/generic/app/ApplicationController","sap/suite/ui/generic/template/genericUtilities/ProcessObserver","sap/suite/ui/generic/template/designtime/utils/DesigntimeHandler","sap/suite/ui/generic/template/lib/Application","sap/suite/ui/generic/template/lib/BusyHelper","sap/suite/ui/generic/template/lib/DataLossHandler","sap/suite/ui/generic/template/lib/navigation/NavigationController","sap/suite/ui/generic/template/lib/TemplateAssembler","sap/suite/ui/generic/template/lib/CRUDHelper","sap/suite/ui/generic/template/lib/ViewDependencyHelper","sap/suite/ui/generic/template/genericUtilities/testableHelper","sap/suite/ui/generic/template/support/lib/CommonMethods","sap/suite/ui/generic/template/genericUtilities/FeLogger","sap/suite/ui/generic/template/lib/navigation/startupParameterHelper","sap/suite/ui/generic/template/lib/PageLeaveHandler","sap/suite/ui/generic/template/lib/ShareUtils","sap/suite/ui/commons/collaboration/CollaborationHelper","sap/insights/CardHelper","sap/suite/ui/generic/template/lib/insights/InsightsFECardProvider","sap/suite/ui/generic/template/lib/ai/JouleContextProvider","sap/ui/core/service/ServiceFactoryRegistry","sap/ui/VersionInfo","sap/m/IllustratedMessageType","sap/suite/ui/generic/template/lib/ai/FioriAIHandler","sap/suite/ui/generic/template/lib/RetryAfterHandler","sap/suite/ui/generic/template/js/RuntimeFormatters","sap/suite/ui/generic/template/lib/ShellPersonalizationService","sap/m/routing/Router","sap/f/routing/Router"],function(e,t,a,n,i,r,o,s,l,p,u,c,g,d,f,v,m,y,b,S,P,h,C,A,M,E,R,N,H,w,T,I,B,V,O,x,D,L){"use strict";var F="lib.AppComponent";var j=new A(F).getLogger();c=h.observableConstructor(c);var U=sap.m.DraftIndicatorState;var G=Object.create(null);var _=b.getRegisterAppComponent();var k=true;if(window["sap-ushell-config"]&&window["sap-ushell-config"].apps&&window["sap-ushell-config"].apps.placeholder){k=window["sap-ushell-config"].apps.placeholder.enabled}var q=sap.ui.require("sap/ushell/Container");var J;function z(){J=J||new u({bundleName:"sap/suite/ui/generic/template/lib/i18n/i18n"}).getResourceBundle();return J.getText.apply(J,arguments)}function Q(){return new g({processObservers:[]})}var W=sap.ui.getCore().getMessageManager().getMessageModel();var X=new o({path:"validation",operator:s.EQ,value1:true});function Y(o,s){var u;var b={oAppComponent:o,leaveAppPromise:Promise.resolve(),ghostapp:function(){var e=o.getManifestEntry("sap.ui.generic.app");return!!(e&&e.settings&&e.settings.ghostapp)}(),componentRegistry:Object.create(null),aRunningSideEffectExecutions:[],getText:z,oTemplatePrivateGlobalModel:(new l).setDefaultBindingMode("TwoWay"),aStateChangers:[],oPaginatorInfo:Object.create(null),oStatePreserversAvailablePromise:Promise.resolve(),oValidationMessageBinding:W.bindList("/",null,null,X),mBusyTopics:Object.create(null),bEnablePlaceholder:k,bStateHandlingSuspended:false,nDelayedDraftTimerInSeconds:20};b.oDataLossHandler=new m(b);b.oPageLeaveHandler=new E(b);b.oValidationMessageBinding.attachChange(Function.prototype);var A;var I;var D;function F(){b.oTemplatePrivateGlobalModel.setProperty("/generic",{draftIndicatorState:U.Clear,shellServiceUnavailable:false,forceFullscreenCreate:false,fioriAI:{isSummarizationEnabled:false,isEasyFilterEnabled:false,isErrorExplanationEnabled:false,isEasyFillEnabled:false}});o.setModel(b.oTemplatePrivateGlobalModel,"_templPrivGlobal");b.oShellServicePromise.catch(function(){b.oTemplatePrivateGlobalModel.setProperty("/generic/shellServiceUnavailable",true)});var e=R.getCurrentUrl();var t;if(q){t=q.getServiceAsync("URLParsing")}Promise.allSettled([e,t]).then(function(e){var t=e[0].value,a=e[1].value;var n=a&&a.isIntentUrlAsync(t);if(n){n.then(function(e){b.oTemplatePrivateGlobalModel.setProperty("/generic/crossAppNavSupport",e)})}else{b.oTemplatePrivateGlobalModel.setProperty("/generic/crossAppNavSupport",false)}});N.isTeamsModeActive().then(function(e){b.oTemplatePrivateGlobalModel.setProperty("/generic/isTeamsModeActive",e)}).finally(function(e){if(!e&&!b.ghostapp){b.oFioriAIHandler=new O(b);b.oFioriAIHandler.loadAILibrary();H.getServiceAsync("UIService").then(function(e){b.oTemplatePrivateGlobalModel.setProperty("/generic/insights",{oInsightsInstance:e,shareCards:Object.create(null)});b.oInsightsFECardProvider=new w(b);b.oInsightsFECardProvider.fnRegisterApplicationAsCardProvider();b.JouleContextProvider=new T(b);b.JouleContextProvider.fnRegisterProvider()}).catch(Function.prototype)}});var a=B.load();a.then(function(e){b.oTemplatePrivateGlobalModel.setProperty("/generic/ui5VersionInfo",e)});b.oTemplatePrivateGlobalModel.setProperty("/generic/shareControlVisibility",J());var n=sap.ui.getCore().getMessageManager().getMessageModel();o.setModel(n,"_templPrivMessage")}function J(){var e=o.getComponentData();return!(e&&e.feEnvironment&&e.feEnvironment.getShareControlVisibility)||e.feEnvironment.getShareControlVisibility()}function Y(){var e=o.getComponentData();return e?.feEnvironment?.getShellService?Promise.resolve(e.feEnvironment.getShellService()):o.getService("ShellUIService")}function K(){b.fnAddSideEffectPromise=function(e){var t=0;for(;b.aRunningSideEffectExecutions[t];){t++}b.aRunningSideEffectExecutions[t]=e;var a=function(){b.aRunningSideEffectExecutions[t]=null};e.then(a,a)};A.attachEvent("beforeSideEffectExecution",function(e){b.fnAddSideEffectPromise(e.getParameter("promise"))});var e=o.getModel("_templPrivGlobal");var t="/generic/draftIndicatorState";A.attachBeforeQueueItemProcess(function(a){if(a.draftSave){e.setProperty(t,U.Saving)}});A.attachOnQueueCompleted(function(){if(e.getProperty(t)===U.Saving){e.setProperty(t,U.Saved)}});A.attachOnQueueFailed(function(){if(e.getProperty(t)===U.Saving){e.setProperty(t,U.Clear)}});e.setProperty("/generic/appComponentName",o.getMetadata().getComponentName())}function Z(){var t=N.processAndExpandHash();var a=o.getId();j.info("Init called for AppComponent "+a);var n=new d(b);G[a]=n;var s={appComponent:o,oTemplateContract:b,application:new f(b),oViewDependencyHelper:new P(b)};b.oViewDependencyHelper=s.oViewDependencyHelper;b.oShellServicePromise=Y();b.oShellServicePromise.catch(function(){j.warning("No ShellService available")});var l=de().settings;if(l&&l.hasOwnProperty("ghostapp")){l=e({},l);delete l.ghostapp}else{l=l||Object.create(null)}if(l.draftSettings&&l.draftSettings.dataSaveFrequency==="immediate"){b.nDelayedDraftTimerInSeconds=0}o.applySettings(l);(i.prototype.init||Function.prototype).apply(o,arguments);b.appSettings=new r(o);b.oBusyHelper.setBusy(b.oShellServicePromise,undefined,undefined,true);D=_(s);var u=o.getModel();b.bCreateRequestsCanonical=true;var g=u.messageScopeSupported();b.oBusyHelper.setBusy(g,undefined,undefined,true);b.oBusyHelper.setBusy(t,undefined,undefined,true);Promise.all([t,g]).then(function(e){var t=e[1];if(t){u.setPersistTechnicalMessages(true);u.setMessageScope(p.BusinessObject);b.bCreateRequestsCanonical=false}A=new c(u);F();I=new y(b);K();S.enableAutomaticDraftSaving(b);if(!u.oMetadata||!u.oMetadata.isLoaded()||u.oMetadata.isFailed()){u.attachMetadataFailed(function(){I.navigateToMessagePage({title:z("ST_GENERIC_ERROR_TITLE"),text:z("ST_GENERIC_ERROR_SYSTEM_UNAVAILABLE"),messageType:V.UnableToLoad,description:z("ST_GENERIC_ERROR_SYSTEM_UNAVAILABLE_DESC")});for(var e in b.componentRegistry){b.componentRegistry[e].fnViewRegisteredResolve(true)}})}if(o&&o.getManifest()){C.setAppComponent(o)}C.setApplicationStatus(C.mApplicationStatus.LOADING);C.publishEvent("elements","ViewRenderingStarted",{});var a=o.getComponentData();var n=a&&a.feEnvironment&&a.feEnvironment.isReadOnly&&a.feEnvironment.isReadOnly();if(!n&&q){q.registerDirtyStateProvider(me)}});ie();var v=new x(b,o);v.registerRetryAfterHandler();b.oShellPersonalizationService=new L(b);var m=b.oShellPersonalizationService.init();b.oBusyHelper.setBusy(m,undefined,undefined,true);j.info("Init done for AppComponent "+a)}function $(){if(b.oNavigationHost){return""}if(o.getFlexibleColumnLayout()){var e=new n(b).initFlexibleColumnLayout();b.oNavigationHost=e;b.aNavigationObservers=[new g({processName:"BeginColumnNavigation",eventHandlers:{attachProcessStart:e.attachBeginColumnNavigate.bind(e),attachProcessStop:e.attachAfterBeginColumnNavigate.bind(e)}}),new g({processName:"MidColumnNavigation",eventHandlers:{attachProcessStart:e.attachMidColumnNavigate.bind(e),attachProcessStop:e.attachAfterMidColumnNavigate.bind(e)}}),new g({processName:"EndColumnNavigation",eventHandlers:{attachProcessStart:e.attachEndColumnNavigate.bind(e),attachProcessStop:e.attachAfterEndColumnNavigate.bind(e)}})];b.oNavigationObserver=new g({processObservers:b.aNavigationObservers});b.aHeaderLoadingObservers=[Q(),Q(),Q()]}else{var t=new a({id:o.getId()+"-appContent"});b.oNavigationHost=t;b.oNavigationObserver=new g({processName:"Navigation",eventHandlers:{attachProcessStart:t.attachNavigate.bind(t),attachProcessStop:t.attachNavigationFinished.bind(t)}})}b.oHeaderLoadingObserver=new g({processObservers:b.aHeaderLoadingObservers||[]});b.oPagesDataLoadedObserver=new g({processObservers:[b.oHeaderLoadingObserver,b.oNavigationObserver]});b.oNavigationHost.addStyleClass(b.oApplicationProxy.getContentDensityClass());b.oBusyHelper=new v(b);b.oBusyHelper.setBusyReason("HashChange",true,true,undefined,true);b.oBusyHelper.getUnbusy().then(function(){b.oShellServicePromise.then(function(e){e.setBackNavigation(b.oApplicationProxy.onBackButtonPressed)})});return b.oNavigationHost}function ee(){for(var e in b.componentRegistry){var t=b.componentRegistry[e];t.utils.leaveApp(false)}}function te(){(b.oNavigationControllerProxy?b.oNavigationControllerProxy.leave:Function.prototype)();var e=o.getId();j.info("Exit called for AppComponent "+e);delete G[e];if(q){q.deregisterDirtyStateProvider(me)}b.ghostapp=true;if(b.oNavigationHost){b.oNavigationHost.destroy()}if(A){A.destroy()}if(I){I.destroy()}if(b.oValidationMessageBinding){b.oValidationMessageBinding.destroy()}if(b.oInsightsFECardProvider){b.oInsightsFECardProvider.unRegisterApplicationAsCardProvider()}if(b.JouleContextProvider){b.JouleContextProvider.fnUnregisterProvider();b.JouleContextProvider.destroy()}C.setAppComponent(null);(i.prototype.exit||Function.prototype).apply(o,arguments);D();h.endApp(s);if(u){u()}j.info("Exit done for AppComponent "+e)}function ae(){for(var e in b.componentRegistry){var t=b.componentRegistry[e];if(t.methods.onSuspend){t.methods.onSuspend()}}ee();if(q){q.deregisterDirtyStateProvider(me)}b.ghostapp=true;b.aStateChangers.forEach(function(e){e.leaveApp()});(b.oNavigationControllerProxy?b.oNavigationControllerProxy.suspend:Function.prototype)();u();u=null}function ne(){b.oBusyHelper.setBusyReason("exiting",false);for(var e in b.componentRegistry){var t=b.componentRegistry[e];if(t.methods.onRestore){t.methods.onRestore()}}ie();if(q){q.registerDirtyStateProvider(me)}b.ghostapp=false;b.oNavigationControllerProxy.restore()}function ie(){b.leaveAppPromise=new Promise(function(e){u=e})}function re(e){var t=Object.keys(e).map(function(t){var a=e[t];if(a.pages){a.pages=re(a.pages)}return e[t]});return t}function oe(e){if(e.pages&&t(e.pages)){e.pages=e.pages&&t(e.pages)?re(e.pages):e.pages}}function se(e,t){if(!e){return}for(var a=0;a<e.length;a++){var n=e[a];if(n.routingSpec&&n.routingSpec.noOData){n.entitySet=n.routingSpec.routeName;if(t>1){n.navigationProperty=n.routingSpec.routeName}}se(n.pages,t+1);if(n.embeddedComponents){for(var i in n.embeddedComponents){var r=n.embeddedComponents[i];if(r.pages){r.pages=re(r.pages);se(r.pages,t+1)}}}if(n.implementingComponent&&n.implementingComponent.pages){n.implementingComponent.pages=re(n.implementingComponent.pages);se(n.implementingComponent.pages,t+1)}}}function le(e){se(e.pages,0)}function pe(e){if(e){var t=e.entitySet;var a=e.component&&e.component.settings&&e.component.settings.quickVariantSelectionX&&e.component.settings.quickVariantSelectionX.variants||{};var n=function(e){for(var t in e){var a=e[t];if(a.entitySet){return true}}return false};if(n(a)){for(var i in a){var r=a[i];if(r.entitySet===undefined){r.entitySet=t}}}}}function ue(e){pe(e.pages[0])}function ce(e){if(e&&e.objectPageDynamicHeaderTitleWithVM){e.objectPageHeaderType=e.objectPageHeaderType||"Dynamic";e.objectPageVariantManagement=e.objectPageVariantManagement||"VendorLayer"}}var ge;function de(){if(!ge){ge=o.getManifestEntry("sap.ui.generic.app");if(Object.keys(ge).length===0){return ge}oe(ge);le(ge);ue(ge);ce(ge.settings)}return ge}var fe;function ve(){if(!fe){fe=e({},o.getManifest());fe["sap.ui.generic.app"]=de()}return fe}function me(e){return!b.ghostapp&&b.oDataLossHandler.getShellDataLossPopup(e)}var ye;var be=false;function Se(){be=false;var e=o.getModel();e.invalidate();for(var t in b.componentRegistry){var a=b.componentRegistry[t];a.utils.refreshBindingUnconditional()}return Promise.resolve()}var Pe={init:Z,createContent:$,exit:te,suspend:ae,restore:ne,getConfig:de,getInternalManifest:ve,getTransactionController:function(){return A.getTransactionController()},getApplicationController:function(){return A},getNavigationController:function(){return I},navigateBasedOnStartupParameter:function(e){if(be){var t=Se();b.oBusyHelper.setBusy(t)}ye=e;b.oBusyHelper.getUnbusy().then(function(){if(!ye||b.oBusyHelper.isBusy()){ye=null;return}var e=b.oNavigationControllerProxy.clearHistory().then(M.parametersToNavigation.bind(null,b,ye));b.oBusyHelper.setBusy(e);ye=null})},refreshForStartupParameter:function(e,t){be=true;if(t){var a=Se();b.oBusyHelper.setBusy(a)}}};var oe=h.testable(oe,"fnNormalizePagesMapToArray");de=h.testable(de,"getConfig");h.testable(ie,"AppComponent_setLeaveAppPromise");return Pe}var K=i.extend("sap.suite.ui.generic.template.lib.AppComponent",{metadata:{interfaces:["sap.ui.core.IAsyncContentCreation"],config:{title:"SAP UI Application Component",fullWidth:true},manifest:{"sap.ui5":{services:{ShellUIService:{factoryName:"sap.ushell.ui5service.ShellUIService"}}}},properties:{forceGlobalRefresh:{type:"boolean",defaultValue:false},considerAnalyticalParameters:{type:"boolean",defaultValue:false},showDraftToggle:{type:"boolean",defaultValue:true},objectPageHeaderType:{type:"string",defaultValue:"Static"},objectPageVariantManagement:{type:"string",defaultValue:"None"},flexibleColumnLayout:{type:"object",defaultValue:null},inboundParameters:{type:"object",defaultValue:null},tableSettings:{type:"object",defaultValue:null},tableColumnVerticalAlignment:{type:"string",defaultValue:"Middle"},useColumnLayoutForSmartForm:{type:"boolean",defaultValue:true},objectPageColumns:{type:"object",properties:{screenSizeXL:{type:"int",defaultValue:6}}},statePreservationMode:{type:"string",defaultValue:"auto"},enableAutoColumnWidthForSmartTable:{type:"boolean",defaultValue:true},draftDiscardConfirmationSettings:{type:"object",defaultValue:{enabled:"always"}},collaborationSettings:{type:"object",defaultValue:{isShareAsCardEnabled:true}},mergeObjectPageSectionTitle:{type:"boolean",defaultValue:true},externalNavigationSettings:{type:"object",defaultValue:null},skipOPContextInfoInBrowserTitle:{type:"boolean",defaultValue:false},noDataRepresentation:{type:"string",defaultValue:"illustration"}},events:{pageDataLoaded:{}},routing:{config:{async:true,viewType:"XML",path:"",clearTarget:false},routes:[],targets:[]},library:"sap.suite.ui.generic.template",designtime:{tool:{start:function(e){var t=sap.ui.require("sap/ui/rta/RuntimeAuthoring");var a=e.getId();j.info("Ui Adaptation started for AppComponent "+a);var n=G[a];if(t&&t.willRTAStartAfterReload()){j.info("AppComponent "+a+" has been restarted for RTA");n.start(true)}else{n.start()}},stop:function(e){var t=e.getId();j.info("Ui Adaptation stopped for AppComponent "+t);var a=G[t];a.stop()}}}},suppressDataLossPopup:function(){return false},constructor:function(){var t=h.startApp();e(this,Y(this,t));(i.prototype.constructor||Function.prototype).apply(this,arguments)}});K._fnGetRouterClassName=function(e){var t=e.getEntry("/sap.ui.generic.app");var a=t&&t.settings&&t.settings.flexibleColumnLayout;var n=a?"f":"m";return"sap."+n+".routing.Router"};return K});
//# sourceMappingURL=AppComponent.js.map