sap.ui.define(["sap/ui/base/Object","sap/ui/core/mvc/ControllerExtension","sap/m/MessageBox","sap/fe/navigation/SelectionVariant","sap/suite/ui/generic/template/genericUtilities/controlHelper","sap/suite/ui/generic/template/genericUtilities/metadataAnalyser","sap/suite/ui/generic/template/genericUtilities/testableHelper","sap/suite/ui/generic/template/genericUtilities/FeLogger","sap/ui/model/analytics/odata4analytics","sap/base/util/extend","sap/base/util/deepExtend","sap/suite/ui/generic/template/genericUtilities/FeError","sap/suite/ui/generic/template/genericUtilities/ControlStateWrapperFactory","sap/suite/ui/generic/template/genericUtilities/oDataModelHelper","sap/ui/core/IconPool","sap/ui/export/util/Filter","sap/ui/model/odata/ODataUtils","sap/ui/comp/util/TableUtil","sap/ui/core/Element"],function(e,t,r,a,n,i,o,l,s,c,u,f,p,g,v,d,m,y,b){"use strict";var h="lib.CommonUtils";var E=new l(h).getLogger();var P={0:[{property:"IsActiveEntity",operator:"==",value:false},{property:"SiblingEntity/IsActiveEntity",operator:"==",value:null}],1:[{property:"IsActiveEntity",operator:"==",value:true},{property:"HasDraftEntity",operator:"==",value:false}],2:[{property:"IsActiveEntity",operator:"==",value:false}],3:[{property:"IsActiveEntity",operator:"==",value:true},{property:"SiblingEntity/IsActiveEntity",operator:"==",value:null},{property:"DraftAdministrativeData/InProcessByUser",operator:"!=",value:""}],4:[{property:"IsActiveEntity",operator:"==",value:true},{property:"SiblingEntity/IsActiveEntity",operator:"==",value:null},{property:"DraftAdministrativeData/InProcessByUser",operator:"==",value:""}],5:[{property:"IsActiveEntity",operator:"==",value:true}]};function D(e,l,D){var C=new p(e);var S=Object.create(null);function A(e){var t=e.getToolbar&&e.getToolbar();if(t){var r=_(t);if(r&&r.annotatedActionIds){S[e.getId()]=JSON.parse(atob(r.annotatedActionIds))}if(r&&r.deleteButtonId){S[e.getId()].push({ID:r.deleteButtonId,RecordType:"CRUDActionDelete"})}if(r&&r.multiEditButtonId){S[e.getId()].push({ID:r.multiEditButtonId,RecordType:"CRUDActionMultiEdit"})}}}function I(e){var t=e.getId();if(!S[t]){A(e)}return S[t]||[]}function O(e,t){var r;var a=y.getCustomColumns(e);var n=a.find(function(e){return(t.data("p13nData")&&t.data("p13nData").columnKey)===(e.data("p13nData")&&e.data("p13nData").columnKey)});if(n){r=n.data("isFERenderedColumn")?false:true}return r}function T(t){var r,a,n;r=e.getOwnerComponent().getModel().getMetaModel();a=r.getODataEntitySet(t);n=r.getODataEntityType(a.entityType);return n}function x(e,t){var r=e.split("?");r[1]=r[1].split("&").map(function(e){if(e.startsWith("$filter")){return t}return e}).join("&");e=r.join("?");return e}function M(t){l.oApplication.attachControlToParent(t,e.getView())}function B(t,r,a){var i=function(e,t){if(e===t){return 0}var a=n.byId(e);var i=n.byId(t);if(!a){if(i){return 1}return e>t?1:-1}if(!i){return-1}if(r){var o=n.isTable(a);var l=n.isTable(i);if(o!==l){return o?1:-1}}var s=a.isFocusable();var c=i.isFocusable();if(s!==c){return s?-1:1}return e>t?1:-1};t=t.concat().sort(i);var o=e.getView();var l=t.find(function(e){var t;var r=a&&function(r){a(e,r,t);t=r};return n.isElementVisibleOnView(e,o,r)});return l}function F(t,r,a,n){return l.oApplication.getDialogFragmentForView(e.getView(),t,r,a,n)}function R(t,r,a,n,i,o){return l.oApplication.getDialogFragmentForViewAsync(e.getView(),t,r,a,n,i,o)}var w;function V(t,r,a){var n=e.getOwnerComponent();w=w||n.getModel("i18n").getResourceBundle();if(r&&!Array.isArray(r)){r=[r]}return w.getText(t,r,a)}function N(e,t,r,a){var n=r||e,i=t&&t!="|"?e+"|"+t:n;var o=V(i,a,true);if(!o&&i!=n){o=V(n,a)}return o}function L(t){var r=e.getOwnerComponent();var a=t.indexOf("::"+r.getEntitySet()+"--")+2;var n=t.substring(a,t.lastIndexOf("::")),n=n.replace(/--/g,"|").replace(/::/g,"|");return n}function k(e,t,r,a){var n=L(t);return N(e,n,r,a)}var U;function j(t,r){var a=null,n;if(U==null){var i=e.getOwnerComponent();var o=i.getModel("i18n").getResourceBundle();U=o.aCustomBundles.filter(e=>!e.oUrlInfo.url.includes("sap/suite/ui/generic/template"))}if(r&&!Array.isArray(r)){r=[r]}for(n=U.length-1;n>=0;n--){a=U[n].getText(t,r,true);if(a!=null){return a}}return null}function H(e,t){var t=t||e.getSelectionBehavior();if(t==="DATAPOINT"){return{dataPoints:e.getSelectedDataPoints().dataPoints,count:e.getSelectedDataPoints().count}}else if(t==="CATEGORY"){return{dataPoints:e.getSelectedCategories().categories,count:e.getSelectedCategories().count}}else if(t==="SERIES"){return{dataPoints:e.getSelectedSeries().series,count:e.getSelectedSeries().count}}}function _(e){var t={};if(e instanceof sap.ui.core.Element){e.getCustomData().forEach(function(e){t[e.getKey()]=e.getValue()})}return t}function K(e){var t,r;var a=ae(e,true);var n=l.oPresentationControlHandlerFactory.getPresentationControlHandler(a).getSelectedContexts();var i=a.getModel();Z(n,i,a);t=I(a);for(var o=0;o<t.length;o++){r=t[o];W(r,n,a)}}function G(t,r,a){var n=e.byId(t.ID);if(!n){return{}}var i;var o;var l;if(t.RecordType==="CRUDActionDelete"){l=Y(a.getModel(),r,a);if(D.getViewLevel()===0){o="/listReport/deleteEnabled"}else{i=Promise.resolve(l)}}else if(t.RecordType==="com.sap.vocabularies.UI.v1.DataFieldForAction"||t.RecordType==="com.sap.vocabularies.UI.v1.DataFieldForIntentBasedNavigation"){var s=a.getModel();var c=s.getMetaModel();i=q(s,c,r,t.RecordType,t.Action,n)}else if(t.RecordType==="CRUDActionMultiEdit"){l=r.filter(X).length>0;o="/listReport/multiEditEnabled";D.getTemplatePrivateModel().setProperty("/listReport/multiEditEnabled",r.filter(X).length>0)}if(i){if(i&&!/generic\/controlProperties/.test(n.getBindingPath("enabled"))){i=null;l=n.getEnabled()}}return{enabledPromise:i,path:o,enabled:l}}function W(e,t,r){var a=G(e,t,r);if(a.path){D.getTemplatePrivateModel().setProperty(a.path,a.enabled)}if(a.enabledPromise){a.enabledPromise.then(z.bind(null,e.ID,"enabled"))}}function J(e){var t=ne(e);Z(l.oPresentationControlHandlerFactory.getPresentationControlHandler(t).getSelectedContexts(),e.getModel(),t)}function z(e,t,r){var a=D.getTemplatePrivateModel();var n=a.getProperty("/generic/controlProperties/"+e);if(!n){n={};n[t]=r;a.setProperty("/generic/controlProperties/"+e,n)}else{a.setProperty("/generic/controlProperties/"+e+"/"+t,r)}}function q(e,t,r,a,i,o){var l,s,c,u;var f=false;if(a==="com.sap.vocabularies.UI.v1.DataFieldForAction"){l=t.getODataFunctionImport(i);c=l&&l["sap:action-for"];if(c&&c!==""&&c!==" "){if(r.length>0){u=l["sap:applicable-path"];if(u&&u!==""&&u!==" "){for(var p=0;p<r.length;p++){if(!r[p]||r[p].isTransient()){continue}s=e.getObject(r[p].getPath());if(s&&s[u]){f=true;break}}}else{f=true}}}else{f=true}}else if(a==="com.sap.vocabularies.UI.v1.DataFieldForIntentBasedNavigation"){if(Ne(r).length>0){f=true}else if(n.isSmartChart(o)){return o.getChartAsync().then(function(){return o.getDrillStackFilters().length>0})}}return Promise.resolve(f)}function Y(e,t,r){if(t.length===0){return false}var a=Q(r);var n=a&&a.Deletable&&a.Deletable.Path;return t.some(function(t){if(t.isInactive()){return false}else if(t.isTransient()){return true}var r=e.getObject(t.getPath()+"/DraftAdministrativeData");var a=!(r&&r.InProcessByUser&&!r.DraftIsProcessedByMe);return a&&!(n&&!e.getProperty(n,t))})}function Q(e){var t=e.getModel()&&e.getModel().getMetaModel();var r=t&&t.getODataEntitySet(e.getEntitySet());var a=r&&r["Org.OData.Capabilities.V1.DeleteRestrictions"];return a}function X(e){var t=e.getModel();var r=t.getObject(e.getPath()+"/DraftAdministrativeData");var a=g.analyseContext(e);var n=l.oApplication.isObjectInEditMode(a.entitySet,a.key);if(!r&&!n){var i=t.getMetaModel().getODataEntitySet(g.analyseContext(e).entitySet);var o=i["Org.OData.Capabilities.V1.UpdateRestrictions"]&&i["Org.OData.Capabilities.V1.UpdateRestrictions"].Updatable;if(o){if(o.Path){return!!t.getProperty(o.Path,e)}else if(o.Bool!=="false"){return true}}else{return true}}}function Z(t,r,a){var n=re(a);var i=D.getTemplatePrivateModel();var o=i.getProperty("/generic/listCommons/breakoutActionsEnabled");if(n){var l=e.byId("template::IconTabBar");var s="";if(l){s=l.getSelectedKey()}te(o,n,t,r,s,a)}i.setProperty("/generic/listCommons/breakoutActionsEnabled",o)}function $(e,t,r,a,n,i){var o=i.id+(a&&!i.determining?"-"+a:"");var l=n&&n.getId().indexOf("AnalyticalListPage")>-1;var s=!l||!!e[o].enabled;var c=ee(i,t,r,n,s,l);e[o]={enabled:c}}function ee(e,t,r,a,i,o){var l=i;var s=e.filter==="chart";if(e.requiresSelection){if(t.length>0){if(e.applicablePath){var c=g.splitAccessPath(e.applicablePath);l=t.some(function(e){var t=r.getObject(e.getPath()+c.navigationPath);return t[c.property]===true})}else{l=l||(s?n.isSmartChart(a):n.isSmartTable(a))}}else if(n.isSmartChart(a)){if(!o||s){l=a.getDrillStackFilters().length>0}}else{l=l&&s}}return l}function te(e,t,r,a,n,i){for(var o in t){var l=t[o];$(e,r,a,n,i,l)}}function re(e){var t=D.getControllerExtensions();var r=_(e).sectionId;if(!r){return t&&t["Actions"]}else{return t&&t.Sections&&t.Sections[r]&&t.Sections[r].Actions}}function ae(e,t){var r=[n.isSmartTable,n.isSmartChart,n.isSmartList];if(!t){r.push(n.isMTable);r.push(n.isUiTable)}var a=function(e,t){return t(e)};for(var i=e;i;i=i.getParent&&i.getParent()){var o=r.some(a.bind(null,i));if(o){return i}}return null}function ne(e){var t=e;while(t){if(n.isSmartTable(t)||n.isSmartChart(t)||n.isSmartList(t)){return t}t=t.getParent&&t.getParent()}return null}function ie(t){if(!l.oApplication.checkEtags(t)){var r=e.getOwnerComponent();var a=r.getModel();var n=a.getMetaModel().getODataEntitySet(t);if(e.getMetadata().getName()==="sap.suite.ui.generic.template.AnalyticalListPage.view.AnalyticalListPage"&&oe(a,n)){a.invalidateEntityType(n.entityType)}else{var i=function(e){return g.analyseContextPath(e,a).entitySet===t};a.invalidate(i)}var o=r.getId();var s=Object.create(null);s[o]=true;l.oApplication.refreshAllComponents(s);return true}return false}function oe(e,t){var r=new s.Model(s.Model.ReferenceByModel(e));var a=r.findQueryResultByName(t.name);var n=a&&a.getParameterization();return!!n}function le(t,r,a){var n;if(D.isDraftEnabled()){n=l.oDraftController.isActiveEntity(t)?1:6}else{var i=e.getOwnerComponent();n=i.getModel("ui").getProperty("/editable")?6:1}if(a){l.oApplication.setObjectInEditMode(true);n=6}D.navigateAccordingToContext(t,n,r)}function se(e){D.openContextInNewTab(e)}function ce(e){if(e instanceof sap.fe.navigation.NavError){if(e.getErrorCode()==="NavigationHandler.isIntentSupported.notSupported"){r.show(V("ST_NAV_ERROR_NOT_AUTHORIZED_DESC"),{title:V("ST_GENERIC_ERROR_TITLE"),icon:r.Icon.ERROR})}else{r.show(e.getErrorCode(),{title:V("ST_GENERIC_ERROR_TITLE"),icon:r.Icon.ERROR})}}}function ue(t,r){Ae(function(){var r=l.oApplication.getNavigationHandler();var a={semanticObject:t.semanticObject,action:t.action};var n=r.mixAttributesAndSelectionVariant(t.parameters);if(typeof e.adaptNavigationParameterExtension==="function"){e.adaptNavigationParameterExtension(n,a)}Re(t);if(t.parameters["sap-ushell-navmode"]==="explace"){r.navigate(t.semanticObject,t.action,n.toJSONString(),null,null,null,t.parameters["sap-ushell-navmode"])}else{l.oApplication.navigateExternal(t.semanticObject,t.action,n.toJSONString(),null,ce)}},Function.prototype,"LeaveApp")}function fe(t){var r=[],a,n,i;var o=e.getOwnerComponent();var l=o.getModel().getMetaModel();if(!t){return{}}var s=o.getAppComponent().getConfig().pages[0];if(!s){return{}}var c=function(e){i=l.getODataEntitySet(e.entitySet).entityType;n=l.getODataEntityType(i);a={};a={entitySet:e.entitySet,aKeys:l.getODataEntityType(i).key.propertyRef,navigationProperty:e.navigationProperty};for(var t=0,r=a.aKeys.length;t<r;t++){var o=0,s=n.property.length;for(o;o<s;o++){if(a.aKeys[t].name===n.property[o].name){a.aKeys[t].type=n.property[o].type;break}}}};var u=function(e,t){if(!t.pages){return r}for(var n=0,i=t.pages.length;n<i;n++){if(!t.pages[n]){break}if(e===t.pages[n].entitySet){c(t.pages[n]);r.splice(0,0,a);break}r=u(e,t.pages[n]);if(r.length>0){c(t.pages[n]);r.splice(0,0,a)}}return r};return u(t,s)}function pe(e,t){var r,a;for(var n=0,i=e.length;n<i;n++){if(e[n].navigationProperty){a+="/"+e[n].navigationProperty}else{a="/"+e[n].entitySet}for(var o=0,l=e[n].aKeys.length;o<l;o++){if(o===0){a+="(";r=""}else{r=","}var s=e[n].aKeys[o];var c=t[s.name];var u=encodeURIComponent(c);switch(s.type){case"Edm.Guid":if(t.DraftAdministrativeData&&t.DraftAdministrativeData.DraftIsCreatedByMe){a+=r+s.name+"="+"guid'"+t.DraftAdministrativeData.DraftUUID+"'"}else{a+=r+s.name+"="+"guid'"+u+"'"}break;case"Edm.Boolean":if(t.DraftAdministrativeData&&t.DraftAdministrativeData.DraftIsCreatedByMe){a+=r+s.name+"="+false}else{a+=r+s.name+"="+u}break;case"Edm.Decimal":case"Edm.Int16":case"Edm.Int32":case"Edm.Int64":case"Edm.Byte":case"Edm.DateTimeOffset":case"Edm.SByte":var f=m.formatValue(u,s.type);a+=r+s.name+"="+f;break;case"Edm.DateTime":var f=m.formatValue(c,s.type);a+=r+s.name+"="+encodeURIComponent(f);break;default:if(typeof u==="string"){a+=r+s.name+"="+"'"+u+"'"}else{a+=r+s.name+"="+u}break}if(o===l-1){a+=")"}}}return a}function ge(e){var t=e.getParameter("originalId"),r=b.getElementById(t),a=ae(r,true),i=Object.create(null);i.smartLink=r;if(n.isSmartTable(a)){var o=l.oPresentationControlHandlerFactory.getPresentationControlHandler(a);i.smartTable=a;i.column=o.getColumnForCell(r)}return i}function ve(e,t,r){var a={getSourceInfo:ge.bind(null,e),oSelectionVariant:t};return!!r.beforeSmartLinkPopoverOpensExtension(a)}function de(e,t,r,a){var n,i,o,s,c,u,f;var p=e.getParameters();var g=l.oApplication.getNavigationHandler();n=g.mixAttributesAndSelectionVariant({},t);if(ve(e,n,r)){return}var v=false;for(s in p.semanticAttributesOfSemanticObjects){v=v||s===p.semanticObject;var d=p.semanticAttributesOfSemanticObjects[s];for(o in d){if(!n.getSelectOption(o)){n.addParameter(o,"")}}c=n.getPropertyNames();u=n.getSelectOptionsPropertyNames();f=n.getParameterNames();for(var m=0,y=c.length;m<y;m++){var b=c[m];if(u.indexOf(b)<0&&f.indexOf(b)<0){delete d[b];n.removeSelectOption(b)}}}if(v){var h=p.semanticAttributesOfSemanticObjects[""];var E=p.semanticAttributesOfSemanticObjects[p.semanticObject];f=n.getParameterNames();f.forEach(function(e){n.removeParameter(e);if(!(e in h)){var t=E[e];t=typeof t==="undefined"||t===null?"":String(t);n.addParameter(e,t)}});n=g.mixAttributesAndSelectionVariant(E,n.toJSONString());n=me(n,e.getSource(),a);var P={semanticObject:p.semanticObject,action:""};r.adaptNavigationParameterExtension(n,P);i=n.toJSONString()}delete p.semanticAttributes;g.processBeforeSmartLinkPopoverOpens(p,i)}function me(t,r,a){var i;var o=[];var l=e.getOwnerComponent().getEntitySet();if(n.isSemanticObjectController(r)||n.isSmartTable(r)){i=r.getEntitySet()}else{var s=ae(r);var c=s&&s.getParent();if(n.isSmartTable(c)){r=c;i=r.getEntitySet()}else{i=l}}o.push(i);var u=a&&a.oMultipleViewsHandler&&a.oMultipleViewsHandler.getMode&&a.oMultipleViewsHandler.getMode()==="multi";if(i!==l&&!u){o.push(l)}o.forEach(function(e){if(r){var a=r.getModel().getMetaModel();var n=a.getODataEntityType(a.getODataEntitySet(e).entityType);t.getPropertyNames().forEach(function(e){var r=a.getODataProperty(n,e);if(r&&(r["com.sap.vocabularies.UI.v1.ExcludeFromNavigationContext"]&&r["com.sap.vocabularies.UI.v1.ExcludeFromNavigationContext"].Bool!=="false"||r["com.sap.vocabularies.PersonalData.v1.IsPotentiallySensitive"]&&r["com.sap.vocabularies.PersonalData.v1.IsPotentiallySensitive"].Bool!=="false")){t.removeSelectOption(e)}})}});return t}function ye(t,r){var a=function(e){for(var t=0;t<e.length;t++){r(e[t].name)}};var n=e.getView().getModel().getMetaModel();var i=n.getODataEntitySet(t,false);var o=n.getODataEntityType(i.entityType,false);a(o.key.propertyRef);var s=l.oDraftController.getDraftContext();if(s.isDraftEnabled(t)){a(s.getSemanticKey(t));r("IsActiveEntity");r("HasDraftEntity");r("HasActiveEntity")}}function be(){return!!(D&&D.getSettings()&&D.getSettings().quickVariantSelectionX)}function he(t,r,a,n){if(n&&a&&a.getAnalyticBindingPath&&a.getConsiderAnalyticalParameters()){try{var o=a.getAnalyticBindingPath();var l=t.getEntitySet();var s=t.getModel();var c=s.getMetaModel();var u=c.getODataEntitySet(l);var f=e.getOwnerComponent();var p=f.getAppComponent();var g=i.getParametersByEntitySet(p.getModel(),l);if(c.getODataEntityType(u.entityType)["sap:semantics"]!=="aggregate"||be()){if(r){var v=r(u,g);o=v||o}}if(o){n(o)}}catch(e){E.warning("Mandatory parameters have no values")}}}function Ee(e,t,r){for(var a=0;a<t.length;a++){var n=t[a];var i=n.lastIndexOf("/");var o;if(i<0){if(l.oApplication.getNavigationProperty(e,n)){o=n}else{continue}}else{o=n.substring(0,i)}if(r.indexOf(o)===-1){r.push(o)}}}function Pe(r,a,n){var i=r.getParameter("bindingParams"),o=r.getSource(),l=o.getId();i.parameters=i.parameters||{};i.parameters.transitionMessagesOnly=D.getNoStateMessagesForTables();var s=function(e,r,n){if(a&&a[e]){var i=true;var o=function(){var a=arguments[0];if(!(a instanceof t)){throw new f(h,"Please provide a valid ControllerExtension in order to execute extension "+e)}if(!i){throw new f(h,"Extension "+e+" must be executed synchronously")}var n=Array.prototype.slice.call(arguments,1);r.apply(null,n)};a[e](o,n);i=false}};var c=function(t){if(!l||e.byId(l)===o){i.filters.push(t)}};if(a.addTemplateSpecificFilters){a.addTemplateSpecificFilters(i.filters)}s("addExtensionFilters",c,l);if(D.getViewLevel()===0){he(o,a.resolveParamaterizedEntitySet,n,a.setBindingPath)}var u=o.getEntitySet();var p=i.parameters.select&&i.parameters.select.split(",")||[];var g=i.parameters.expand&&i.parameters.expand.split(",")||[];var v=function(t,r){if(t&&(!r||e.byId(r)===o)){var a=t.split(",");a.forEach(function(e){if(e&&p.indexOf(e)===-1){p.push(e)}})}};if(a.isMandatoryFiltersRequired){ye(u,v)}s("ensureExtensionFields",v,l);(a.addNecessaryFields||Function.prototype)(p,v,u);Ee(u,p,g);if(g.length>0){i.parameters.expand=g.join(",")}if(p.length>0){i.parameters.select=p.join(",")}}function De(e,t,r){if(!e){return V("DRAFT_OBJECT")}else if(t){return V(r?"LOCKED_OBJECT":"UNSAVED_CHANGES")}else{return""}}function Ce(){return new Promise(function(e){var t;R("sap.suite.ui.generic.template.fragments.DraftAdminDataPopover",{formatText:function(){var e=Array.prototype.slice.call(arguments,1);var t=arguments[0];if(!t){return""}if(e.length>0&&(e[0]===null||e[0]===undefined||e[0]==="")){if(e.length>3&&(e[3]===null||e[3]===undefined||e[3]==="")){return e.length>2&&(e[1]===null||e[1]===undefined||e[1]==="")?"":e[2]}else{return V(t,e[3])}}else{return V(t,e[0])}},closeDraftAdminPopover:function(){t.close()},formatDraftLockText:De},"admin").then(function(r){t=r;e(t)})})}function Se(e,t,r,a){return l.oDataLossHandler.performIfNoDataLoss(e,t,a,true,true)}function Ae(e,t,r,a){r=r||"LeavePage";if(D.isDraftEnabled()){return l.oPageLeaveHandler.performAfterDiscardOrKeepDraft(e,t,r,a,false)}else{return l.oDataLossHandler.performIfNoDataLoss(e,t,r,a,false)}}function Ie(e,t){t=u({busy:{set:true,check:true},dataloss:{popup:true,navigation:false}},t);var r,a;var n=new Promise(function(e,t){r=e;a=t});var i=t.busy.set?function(){if(!D.isDraftEnabled()){l.oApplication.getBusyHelper().setBusy(n,false,{actionLabel:t.sActionLabel})}return e()}:e;var o=t.mConsiderObjectsAsDeleted?function(){l.oApplication.prepareDeletion(t.mConsiderObjectsAsDeleted);return i()}:i;var s=function(){var e;if(D.isDraftEnabled()){l.oApplication.getBusyHelper().setBusy(n,false,{actionLabel:t.sActionLabel});e=l.oApplicationController.synchronizeDraftAsync().then(function(){return o()})}else{e=t.dataloss.popup?Ae(o,a,t.dataloss.navigation?"LeavePage":"Proceed",true):o()}if(e instanceof Promise){e.then(r,a)}else{r(e)}};l.oApplication.performAfterSideEffectExecution(s,t.busy.check&&a);return n}function Oe(e){var t=e.getId()+"-variant";var r=b.getElementById(t);var a=r.getDefaultVariantKey();return a===r.STANDARDVARIANTKEY?"":a}function Te(e){var t=e.getId()+"-variant";var r=b.getElementById(t);var a=r.getDefaultVariantKey();return a===r.STANDARDVARIANTKEY?"":a}function xe(t){var r=t.getToolbar();var a=D.getTemplatePrivateModel();var n=e.getOwnerComponent();var i=[],o=[];var l=n.getAppComponent();var s=sap.ui.require("sap/ushell/Container");var u=s&&s.getServiceAsync("Navigation");var f=a.getProperty("/generic/supportedIntents/");var p=r.getContent();var g=p.length;for(var v=0;v<g;v++){var d=_(p[v]);if(d.hasOwnProperty("SemanticObject")&&d.hasOwnProperty("Action")){var m=d.SemanticObject;var y=d.Action;var b={semanticObject:m,action:y,ui5Component:l};i.push(b);var h=c({},b);h.bLinkIsSupported=false;o.push(h)}}if(!i.length||!u){return}u.then(function(e){var t=e.getLinks(i);t.then(function(t){f=a.getProperty("/generic/supportedIntents/");var r=t.length;var n=[],i=[];for(var s=0;s<r;s++){if(t[s].length>0){var c=e.getHref({target:{shellHash:t[s][0].intent}},l);n.push(c);i.push(o[s])}}Promise.all(n).then(function(e){for(var t=0;t<e.length;t++){if(e[t]){i[t].bLinkIsSupported=true}}}).then(function(){o.forEach(function(e){var t=e.semanticObject,r=e.action,n=a.getProperty("/generic/supportedIntents/"+t);if(!n){f[t]={};f[t][r]={visible:e.bLinkIsSupported}}else if(!n[r]){n[r]={visible:e.bLinkIsSupported}}else{n[r]["visible"]=e.bLinkIsSupported}});a.updateBindings()})})})}function Me(t,r){var a=r&&e.byId(r);var n=r&&!a?Promise.reject():new Promise(function(e,r){l.oApplication.performAfterSideEffectExecution(function(){var n=l.oApplication.getBusyHelper();if(n.isBusy()){r();return}if(a&&(!a.getVisible()||a.getEnabled&&!a.getEnabled())){r();return}var i=a?t(a):t();if(i instanceof Promise){i.then(e,r);n.setBusy(i)}else{e(i)}})});n.catch(Function.prototype);return n}function Be(t,r,a,n,i){var o;let s=n?.bInvocationGroupingChangeSet?"com.sap.vocabularies.UI.v1.OperationGroupingType/ChangeSet":"";let c=n?.sLabel??"";let u=n?.bStrict??false;if(!r){o=[]}else if(Array.isArray(r)){o=r}else{o=[r]}D.executeBeforeInvokeActionFromExtensionAPI(i);const f=l.oCRUDManager.callAction({contexts:o,functionImportPath:t,label:c,operationGrouping:s,skipProperties:{},urlParameters:a,bStrict:u,bInvokedByExtensionApi:true,oModelFromExtensionApi:e.getOwnerComponent()?.getModel()},i);if(n&&n.bSetBusy){D.getBusyHelper().setBusy(f)}f.then(D.executeAfterInvokeActionFromExtensionAPI.bind(null,i));return f}function Fe(e){var t=l.oApplication.getChevronNavigationRefreshBehaviour(e);if(t!==Object.create(null)){l.oViewDependencyHelper.setRefreshBehaviour(t)}}function Re(e){var t=l.oApplication.getComponentRefreshBehaviour(e);l.oViewDependencyHelper.setRefreshBehaviour(t)}function we(e,t){var r=t.getModel();var a=t.getPath().split("/")[1];var n=r.oData[a];if(e){var i=n&&n[e]&&n[e].__ref;var o=r.oData[i];return o}else{return n}}function Ve(t,r){if(t&&t.__metadata){var a=t.__metadata.edit_media;var n=t.__metadata.content_type;var i="";if(a){if(a.startsWith("http:")||a.startsWith("https:")){var o=a&&new URL(a);i=o&&o.pathname}else{i=a}}var l=v.getIconForMimeType(n);var s={url:i,fileType:n,icon:l};var c=D.getTemplatePrivateModel();var u=e.getOwnerComponent().getEntitySet();if(!c.getProperty("/generic/controlProperties/fileUploader")){c.setProperty("/generic/controlProperties/"+"fileUploader",{})}if(r){c.setProperty("/generic/controlProperties/"+"fileUploader/"+r,s)}else{c.setProperty("/generic/controlProperties/"+"fileUploader/"+u,s)}}}function Ne(e){return e.filter(function(e){return!e||!e.isTransient()})}function Le(t,r,a,n){var o=e.getOwnerComponent().getModel().getMetaModel();var l=i.getNavigationPropertyRelationship(o,t,r);var s=i.getNavigationPropertyRelationship(o,a,n);return l.relationship===s.relationship&&l.fromRole===s.toRole&&l.toRole===s.fromRole}function ke(t){var r=t.getSource();return n.isButton(r)?r.data():b.getElementById(e.createId(_(r)["ActionId"])).data()}function Ue(t){if(!D.isDraftEnabled()){return}var r=e.byId("editStateFilter");if(!r){return}var a=r.getSelectedKey(),n=P[a];n.forEach(function(e){var r=t.findIndex(function(t){return e.property===t.property&&e.operator===t.rawValues[0].operator&&e.value===t.rawValues[0].value&&t.rawValues.length===1});if(r!==-1){t.splice(r,1)}});var i=r.getLabels().at(0).getText(),o=r.getSelectedItem().getText(),l={operator:"==",value:o};var s=new d("editStateFilter",l,i);t.push(s)}function je(t,r){var n=t.getSmartFilterId();if(!n){return}var i=e.byId(n);var o=i.getAnalyticalParameters();if(!o.length){return}var l=i&&i.getUiState({allFilters:false});var s=l?JSON.stringify(l.getSelectionVariant()):"{}";var c=new a(s);o.forEach(function(e){var t=c.getParameter(e.name);if(!t){return}if(e.type==="Edm.DateTime"||e.type==="Edm.DateTimeOffset"){t=new Date(t)}var a=new d(e.name,{operator:"==",value:t},e.fieldLabel);a.setType(e.ui5Type);r.push(a)})}var Z=o.testable(Z,"fillEnabledMapForBreakoutActions");var ae=o.testable(ae,"getOwnerControl");var I=o.testable(I,"fnGetToolbarCustomData");var me=o.testable(me,"removePropertiesFromNavigationContext");return{getPositionableControlId:B,getMetaModelEntityType:T,fnReplaceFiltersWithGetDownloadUrl:x,getText:V,getSpecializedText:N,getSpecificI18nKeyForSmartControl:L,getContextText:k,getNavigationKeyProperties:fe,mergeNavigationKeyPropertiesWithValues:pe,isMultiViewMultiEntity:be,executeGlobalSideEffect:function(){if(D.isDraftEnabled()){var t=e.getView();var r=e.getOwnerComponent();var a=r.getAppComponent();var i=a.getForceGlobalRefresh();var o=r.getModel("ui");t.attachBrowserEvent("keydown",function(e){var r=e.target.type==="search";var a=e.target.type==="textarea";var s=e.target.id.indexOf("rowAction")>-1;var c=e.target.id.indexOf("ColumnListItem")>-1;if(e.keyCode===13&&e.ctrlKey!==true&&o.getProperty("/editable")&&!r&&!a&&!s&&!c){l.oApplication.addSideEffectPromise(new Promise(function(e,r){var a,o,s,c=false,u={draftRootContext:D.getMainComponentDetails().bindingContext,callPreparationOnDraftRoot:true,callPreparationOnly:false};var f=function(){setTimeout(function(){var t=l.oApplicationController.executeSideEffects(s,null,null,i,u);t.then(function(){e()},r)})};var p=function(e){var t=e.getFirstInnerControl&&e.getFirstInnerControl();if(t.getValue()!==t.getLastValue()){return true}return false};o=n.getControlWithFocus();while(o){if(n.isSmartField(o)){s=o.getBindingContext&&o.getBindingContext();if(s.isTransient()){if(!p(o)){u.callPreparationOnly=true}f();return e()}}else if(n.isOverflowToolbar(o)||n.isButton(o)||n.isLink(o)||n.isMultiInputField(o)&&(o._sTypedInValue&&o._sTypedInValue.length>0)){c=true}else if(n.isSmartForm(o)){a=o;break}else if(n.isSmartTable(o)){break}o=o.getParent()}if(c){u={}}s=s||o&&o.getBindingContext&&o.getBindingContext()||t.getBindingContext();var g=a?a.check():Promise.resolve();g.then(f)}))}})}},setEnabledToolbarButtons:K,setEnabledFooterButtons:J,getToolbarActionEnablementInfo:G,fillEnabledMapForBreakoutActions:Z,getBreakoutActions:re,isBreakoutActionEnabled:ee,getSelectionPoints:H,getDeleteRestrictions:Q,getSmartTableDefaultVariant:Oe,getSmartChartDefaultVariant:Te,setPrivateModelControlProperty:z,removePropertiesFromNavigationContext:me,navigateFromListItem:le,navigateExternal:ue,semanticObjectLinkNavigation:de,getCustomData:function(e){var t=e.getSource().getCustomData();var r={};for(var a=0;a<t.length;a++){r[t[a].getKey()]=t[a].getValue()}return r},getToolbarCustomData:I,isSupportedColumn:function(e,t,r){var a=e.data("p13nData")&&e.data("p13nData").columnKey;if(a.indexOf("DataFieldForAnnotation")>-1||a.indexOf("DataFieldForAction")>-1||a.indexOf("DataFieldForIntentBasedNavigation")>-1||t&&t["com.sap.vocabularies.UI.v1.IsImageURL"]&&t["com.sap.vocabularies.UI.v1.IsImageURL"].Bool==="true"||e.data("addCardtoInsightsConfig")&&e.data("addCardtoInsightsConfig").isMultiValueColumn||O(r,e)){return false}return true},isCustomColumn:O,getCustomDataText:function(e){return new Promise(function(t,r){e.getCustomData().forEach(function(e){var r=e.getKey();if(r==="text"){var a=e.getBinding("value");var n=!a&&e.getBindingInfo("value");if(!a&&!n){t(e.getValue());return}var i=function(e){var r=e.getSource();r.detachChange(i);t(r.getExternalValue());return};if(a){if(!a.isInitial()){t(a.getExternalValue());return}a.attachChange(i)}else{n.events={change:i};for(var o=0;o<n.parts.length;o++){n.parts[o].targetType="string"}}}})})},onBeforeRebindTableOrChart:Pe,formatDraftLockText:De,showDraftPopover:function(e,t){Ce().then(function(r){var a=r.getModel("admin");a.setProperty("/IsActiveEntity",e.getProperty("IsActiveEntity"));a.setProperty("/HasDraftEntity",e.getProperty("HasDraftEntity"));r.bindElement({path:e.getPath()+"/DraftAdministrativeData"});if(r.getBindingContext()){r.openBy(t)}else{r.getObjectBinding().attachDataReceived(function(){r.openBy(t)})}})},getContentDensityClass:function(){return l.oApplication.getContentDensityClass()},attachControlToView:M,getDialogFragment:F,getDialogFragmentAsync:R,fnProcessDataLossOrDraftDiscardConfirmation:Ae,processDataLossTechnicalErrorConfirmation:Se,securedExecution:Ie,getOwnerControl:ae,getOwnerPresentationControl:ne,refreshModel:ie,getElementCustomData:_,triggerAction:function(t,r,a,n){l.oDataLossHandler.performIfNoDataLoss(function(){l.oCRUDManager.callAction({functionImportPath:a.Action,contexts:t,sourceControlHandler:n,label:a.Label,operationGrouping:"",actionType:a.ActionType}).then(function(n){if(n&&n.length>0){var i=n[0];var o=i.response&&i.response.context||i.context;var s=o&&o.getPath();var c=o&&(!i.actionContext||s!==i.actionContext.getPath());if(c){l.oViewDependencyHelper.setMeToDirty(e.getOwnerComponent(),r,false,s==="/undefined"||t.length>1);if(a.ActionType==="determining"){l.oViewDependencyHelper.setParentToDirty(e.getOwnerComponent(),r,1)}}}})},Function.prototype,"Proceed",undefined,false)},checkToolbarIntentsSupported:xe,executeIfControlReady:Me,invokeActionsForExtensionAPI:Be,isContextEditable:X,setExternalChevronRefreshBehaviour:Fe,setComponentRefreshBehaviour:Re,getStreamData:we,setStreamData:Ve,getControlStateWrapper:C.getControlStateWrapper,filterActiveContexts:Ne,checkInverseNavigation:Le,getCustomDataFromEvent:ke,getControlStateWrapperById:C.getControlStateWrapperById,handleError:ce,transformTechnicalPropsOnExportedFile:Ue,includeEntitySetParametersToExportedFile:je,openContextInNewTabFromListItem:se,getCustomizedTextFromApp:j}}return e.extend("sap.suite.ui.generic.template.lib.CommonUtils",{constructor:function(e,t,r){c(this,D(e,t,r))}})});
//# sourceMappingURL=CommonUtils.js.map