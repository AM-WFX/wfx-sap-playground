// Copyright (c) 2009-2025 SAP SE, All Rights Reserved
sap.ui.define(["sap/ui/base/EventProvider","sap/ui/core/Component","sap/ui/thirdparty/hasher","sap/ui/thirdparty/URI","sap/ushell/AppInfoParameters","sap/ushell/Config","sap/ushell/Container","sap/ushell/EventHub","sap/ushell/services/AppConfiguration","sap/ushell/TechnicalParameters","sap/ushell/renderer/RendererManagedComponents","sap/ushell/utils"],(e,t,n,p,i,o,a,r,s,l,c,u)=>{"use strict";const h="appLoaded";function A(t,n,p,i){this._oCurrentApplication=null;this._oCurrentApplicationContainer=null;this._oEventProvider=new e;if(window.QUnit===undefined&&a.inAppRuntime()===false){if(o.last("/core/shell/enableMessageBroker")){a.getServiceAsync("MessageBroker").then(async e=>{await e.connect(e.ClientAlias.FLP,()=>{});e.subscribe(e.ClientAlias.FLP,[{channelId:"flp-app-info",version:"1.0"}],this._handleIncomingMessageBrokerMessage.bind(this,e))})}}}A.prototype.init=function(e){e.attachAfterNavigate(this.onAfterNavigate.bind(this))};A.prototype._handleIncomingMessageBrokerMessage=function(e,t,n,p,i){if(n==="flp-app-info"&&p==="get-current-app-info"&&this._oCurrentApplication){this._oCurrentApplication.getAllAppInfo(true).then(n=>{e.publish("flp-app-info",e.ClientAlias.FLP,Date.now().toString(),p,[t],n)})}};A.prototype.onAfterNavigate=async function(e){let n=false;const p=e.getParameter("to");let i;if(p?.isA("sap.ushell.appIntegration.UI5ApplicationContainer")){const e=p;i=e.getComponentHandle().getInstance()}else if(p?.isA("sap.ui.core.ComponentContainer")){const e=p;i=t.getComponentById(e.getComponent());if(i?.isA("sap.ushell.renderer.rendererTargetWrapper.Component")){i=await i.getComponentInstance()}}if(i){n=c.isManagedComponentInstance(i)}let o;let a;if(p?.isA("sap.ushell.appIntegration.ApplicationContainer")){a=p;o=a.getApplicationType()}if((!o||o==="URL")&&i){o="UI5"}this._setCurrentApplicationObject(o,i,n,a)};A.prototype._getAppIntent=async function(e){const t=n.getHash();let i;if(!t){throw new Error("Could not identify current application hash")}const o=a.getServiceAsync("URLParsing");return o.then(n=>{i=n.parseShellHash(t);if(e===true&&this._oCurrentApplicationContainer&&typeof this._oCurrentApplicationContainer.getCurrentAppUrl==="function"){const e=this._oCurrentApplicationContainer.getCurrentAppUrl();if(e){const t=new p(e).search(true);if(t.hasOwnProperty("sap-remote-intent")){i.semanticObject=t["sap-remote-intent"].split("-")[0];i.action=t["sap-remote-intent"].split("-")[1];delete i.params["sap-shell-so"];delete i.params["sap-shell-action"]}}}return i})};A.prototype._setCurrentApplicationObject=function(e,t,n,p){this._oCurrentApplicationContainer=p;this._oCurrentApplication={applicationType:e,componentInstance:t,homePage:n,getTechnicalParameter:function(n){return l.getParameterValue(n,t,p,e)},getIntent:this._getAppIntent.bind(this),getInfo:function(e){return i.getInfo(e,this._oCurrentApplication,p)}.bind(this),getAllAppInfo:function(e){return i.getAllAppInfo(e,this._oCurrentApplication,t,p).then(t=>{if(e===true){t.applicationType=this._oCurrentApplication.applicationType;t.homePage=this._oCurrentApplication.homePage}else{t.applicationType={value:this._oCurrentApplication.applicationType};t.homePage={value:this._oCurrentApplication.homePage}}return t})}.bind(this),getSystemContext:function(){const e=s.getCurrentApplication()||{};const t=e.contentProviderId||"";return a.getServiceAsync("ClientSideTargetResolution").then(e=>e.getSystemContext(t))},disableKeepAliveAppRouterRetrigger:function(e){this.useLegacyRestoreFlowForCurrentApplication(this._oCurrentApplication.componentInstance?.oContainer?.sId,e)}.bind(this)};setTimeout(()=>{this._oEventProvider.fireEvent(h,this._oCurrentApplication);r.last("trackHashChange");this._oCurrentApplication.getInfo(["technicalAppComponentId"]).then(e=>{if(!c.isManagedComponentName(e?.technicalAppComponentId)){r.emit("FESRAppLoaded",{technicalName:e.technicalAppComponentId})}});if(window.QUnit===undefined&&a.inAppRuntime()===false){if(o.last("/core/shell/enableMessageBroker")){a.getServiceAsync("MessageBroker").then(e=>{this._oCurrentApplication.getAllAppInfo(true).then(t=>{e.publish("flp-app-info",e.ClientAlias.FLP,"new-app-info","*",t)})})}}},0)};A.prototype.useLegacyRestoreFlowForCurrentApplication=async function(e,t){const[n]=await u.requireAsync(["sap/ushell/appIntegration/AppLifeCycle"]);return n.useLegacyRestoreFlowForCurrentApplication()};A.prototype.getCurrentApplication=function(){return this._oCurrentApplication};A.prototype.attachAppLoaded=function(e,t,n){this._oEventProvider.attachEvent(h,e,t,n)};A.prototype.detachAppLoaded=function(e,t){this._oEventProvider.detachEvent(h,e,t)};A.prototype.prepareCurrentAppObject=function(e,t,n,p,i){this._setCurrentApplicationObject(e,t,n,p,i)};A.prototype.reloadCurrentApp=function(){const e=this.getCurrentApplication();r.emit("reloadCurrentApp",{sAppContainerId:this._oCurrentApplicationContainer?.getId?.(),sAppId:e.componentInstance?.getId?.(),sCurrentHash:n.getHash(),date:Date.now()})};A.prototype.setAppInfo=function(e,t){i.setCustomAttributes(e?.info);if(o.last("/core/shell/enableMessageBroker")){a.getServiceAsync("MessageBroker").then(e=>{this._oCurrentApplication.getAllAppInfo(true).then(n=>{e.publish("flp-app-info",e.ClientAlias.FLP,t===true?"new-app-info":"app-info-update","*",n)})})}};A.prototype.ApplicationType={UI5:"UI5",WDA:"WDA",NWBC:"NWBC",URL:"URL",TR:"TR"};A.prototype.AppInfoParameterName={productName:"productName",theme:"theme",languageTag:"languageTag",appIntent:"appIntent",appFrameworkId:"appFrameworkId",technicalAppComponentId:"technicalAppComponentId",appId:"appId",appVersion:"appVersion",appSupportInfo:"appSupportInfo",appFrameworkVersion:"appFrameworkVersion","abap.transaction":"abap.transaction"};A.hasNoAdapter=true;return A},true);
//# sourceMappingURL=AppLifeCycle.js.map