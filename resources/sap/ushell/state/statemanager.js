// Copyright (c) 2009-2025 SAP SE, All Rights Reserved
sap.ui.define(["sap/base/Log","sap/ui/thirdparty/hasher","sap/ushell/Config","sap/ushell/state/BaseState","sap/ushell/state/ControlManager","sap/ushell/state/CurrentState","sap/ushell/state/ShellModel","sap/ushell/state/StateRules","sap/ushell/state/StateManager/LaunchpadState","sap/ushell/state/StateManager/Operation","sap/ushell/state/StateManager/ShellMode","sap/ushell/utils","sap/ushell/utils/UrlParsing"],(e,t,a,s,l,i,n,r,h,d,o,u,p)=>{"use strict";const{Default:g,Standalone:c,Lean:S,Minimal:f}=o;class C{#e=u.deepFreeze({sideNavigation:{visible:true},sidePane:{visible:false,items:[]},toolArea:{visible:false,items:[]},rightFloatingContainer:{visible:false,items:[]},floatingContainer:{visible:false,state:"floating",dragSelector:"",items:[]},userActions:{items:[]},floatingActions:{items:[]},header:{visible:true,logo:{src:undefined,alt:undefined},secondTitle:"",headItems:[],headEndItems:[],notifications:{visible:false,count:0}},subHeader:{items:[]},footer:{content:""},application:{title:"",titleAdditionalInformation:{headerText:"",additionalContext:"",searchTerm:"",searchScope:""},icon:"",contentDensity:"",subTitle:"",relatedApps:[],hierarchy:[]}});#t=false;#a=h.Home;#s=o.Default;#l=o.Default;#i=null;#n=i;#r=false;#h=false;#d=[];LaunchpadState=h;ShellMode=o;Operation=d;constructor(){this.#o()}#o(){const e=this.#u();this.#l=e;this.#s=e;const a=p.parseShellHash(t.getHash(),true);const l=p.isEmptyHash(a)||p.isRootIntent(a);this.#a=l?h.Home:h.App;this.#i=new s(this.#e);this.#n.attachStateChange(this.#p,this);this.#p()}init(e){if(this.#t){throw new Error("State Manager is already initialized!")}this.#t=true;r.setShellConfig(e);this.#p()}getShellMode(){return this.#l}getLaunchpadState(){return this.#a}switchState(e,t){this.#g(e);const a=t??this.#s;this.#c(a);this.#l=a;this.#a=e;this.#p()}updateBaseStates(e,t,a,s){this.#S(a);this.#f(e);if(this.#h){this.#d.push({handler:this.updateBaseStates.bind(this),args:arguments});return}e.forEach(e=>{this.#i.updateState(e,t,a,s)});this.#p()}updateAllBaseStates(e,t,a){this.updateBaseStates(Object.values(h),e,t,a)}updateCurrentState(e,t,a){this.#S(t);if(this.#h){this.#d.push({handler:this.updateCurrentState.bind(this),args:arguments});return}this.#n.updateState(e,t,a);this.#p()}refreshState(e){const t=n.getModel();const a=t.getBindings();const s=`/${e.replace(/\./g,"/")}`;const l=a.filter(e=>{const t=e.getResolvedPath();if(!t){return false}return t.startsWith(s)});l.forEach(e=>{e.refresh(true)})}addManagedControl(e,t){if(this.#h){this.#d.push({handler:this.addManagedControl.bind(this),flushHandler:(e,t)=>{l.destroyManagedControl(e)},args:arguments});return}l.addManagedControl(e,!t,this.#a)}updateManagedControl(e,t){if(this.#h){this.#d.push({handler:this.updateManagedControl.bind(this),args:arguments});return}l.updateManagedControl(e,!t)}removeManagedControl(e){if(this.#h){this.#d.push({handler:this.removeManagedControl.bind(this),args:arguments});return}l.removeManagedControl(e)}destroyManagedControls(){l.destroyManagedControls()}#p(){if(this.#h||this.#r){return}const e=this.#i.getStateData(this.#l,this.#a);this.#n.applyState(e);r.applyRules(e,this.#l,this.#a);n.updateModel(e)}#u(){let t;const s=new URLSearchParams(window.location.search);if(s.has("sap-ushell-config")){t=s.get("sap-ushell-config")}else{t=a.last("/core/state/shellMode");(()=>{if(s.has("appState")){t=s.get("appState");if(t){e.error("URL parameter 'appState' is given, but deprecated. Please use 'sap-ushell-config' instead!","sap.ushell.renderer.Renderer")}}else{t=a.last("/core/state/shellMode")}})()}t=t?.toLowerCase()??o.Default;try{this.#c(t)}catch(a){e.error(`Error occurred during validation: "${a.message}", Defaulting to default ShellMode`);t=o.Default}return t}stallChanges(){this.#h=true}applyStalledChanges(){this.#h=false;this.#r=true;this.#d.forEach(({handler:e,args:t})=>{e(...t)});this.#d=[];this.#r=false;this.#p()}discardStalledChanges(){this.#h=false;this.#d.forEach(({flushHandler:e,args:t})=>{if(e){e(...t)}});this.#d=[]}reset(){this.#n.detachStateChange(this.#p,this);this.#o();this.#t=false;this.#r=false;this.#h=false;this.#d=[]}resetAll(){r.reset();l.reset();n.reset();this.#n.reset();this.reset()}destroy(){this.#n.detachStateChange(this.#p,this);this.#n.destroy();n.destroy();l.destroy()}#c(e){if(!Object.values(o).includes(e)){throw new Error(`Invalid shell mode: ${e}`)}}#S(e){if(!Object.values(d).includes(e)){throw new Error(`Invalid operation: ${e}`)}}#g(e){if(!Object.values(h).includes(e)){throw new Error(`Invalid launchpad state: ${e}`)}}#f(e){if(!Array.isArray(e)){throw new Error("Launchpad states must be provided as an array!")}if(e.length===0){throw new Error("No launchpad states provided!")}e.forEach(e=>{this.#g(e)})}isLegacyHome(){if(this.getLaunchpadState()!==h.Home){return false}const e=[g,c,S,f];return e.includes(this.getShellMode())}}return new C});
//# sourceMappingURL=StateManager.js.map