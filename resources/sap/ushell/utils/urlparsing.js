// Copyright (c) 2009-2025 SAP SE, All Rights Reserved
sap.ui.define(["sap/ui/thirdparty/URI","sap/base/Log","sap/base/util/deepClone","sap/base/util/deepEqual","sap/base/util/merge","sap/ushell/TechnicalParameters","sap/ushell/utils"],(t,e,n,s,a,r,c)=>{"use strict";const o={};const i=/^(([A-Za-z0-9_/]+)-([A-Za-z0-9_/-]+)(~([A-Z0-9a-z=+/]+))?)?([?]([^&]|(&[^/]))*&?)?$/;o.getShellHash=function(t){const e=/[^#]*#(([^&]|&[^/])*)(&\/.*)?/;const n=e.exec(t);if(n){return n[1]}};o.getHash=function(t){const e=/#(.*)/;const n=e.exec(t);if(n){return n[1]}};o.isIntentUrl=function(t){return this._isIntentUrl(t,window.location.href)};o.isIntentUrlAsync=async function(t){const[e]=await c.requireAsync(["sap/ushell/Container"]);const n=await e.getFLPUrlAsync(true);return this._isIntentUrl(t,n)};o._isIntentUrl=function(e,n){const s=/^#/;if(typeof e!=="string"){return false}if(!s.test(e)){const s=new t(e).normalize();const a=`${s.protocol()}://${s.host()}${s.pathname()}`;const r=new t(n).normalize();const c=`${r.protocol()}://${r.host()}${r.pathname()}`;if(a!==c){return false}}const a=this.getHash(e);if(!a){return false}const r=this.parseShellHash(a);if(r&&r.semanticObject&&r.action){return true}return false};o.parseParameters=function(t){try{const e=new URLSearchParams(t);const n=e.keys();let s=n.next();const a={};while(s.done===false){a[decodeURIComponent(s.value)]=e.getAll(s.value);s=n.next()}return a}catch(n){e.error(`URL parsing - malformed URL parameters string: ${t}`,n);return{}}};o.paramsToString=function(t){return this.urlParametersToString(t)};o.removeParametersWithEmptyValue=function(t,e){if(!t){return}Object.keys(t).forEach(n=>{if(e.includes(n)&&t[n].length===1&&t[n][0]===""){delete t[n]}})};o.urlParametersToString=function(t,e,n){let s="";e=e||"&";n=n||"=";let a="";const r=[];for(const e in t){if(t.hasOwnProperty(e)){r.push(e)}}r.sort();for(let c=0;c<r.length;c=c+1){const o=r[c];if(Array.isArray(t[o])){for(let r=0;r<t[o].length;r=r+1){s+=a+encodeURIComponent(o)+n+encodeURIComponent(t[o][r]);a=e}}else{s+=a+encodeURIComponent(o)+n+encodeURIComponent(t[o]);a=e}}return s};o.addParamsToUrl=function(e,n){const s=new t(e);Object.keys(n).forEach(t=>{s.addSearch(t,n[t])});return s.toString()};o.addShellParamsToURL=function(e,n){const s=new t(e);const a=s.hash();const r=s.toString().replace(a,"");const c=this.parseShellHash(a)||{};Object.assign(c.params,n.params);const o=`#${this.constructShellHash(c)}`;return r+o};o.parseShellHash=function(t,e){const n=i;if(!t){if(e){return this.getEmptyParsedHash()}return}const s=this.splitHash(t);const a=n.exec(s.shellPart);if(a){const t=a[2];const e=a[3];const n=a[5];const r=a[6];const c=this.parseParameters(r);return{semanticObject:t,action:e,contextRaw:n,params:c,appSpecificRoute:s.appSpecificRoute}}if(s.appSpecificRoute){return{semanticObject:undefined,action:undefined,contextRaw:undefined,params:{},appSpecificRoute:s.appSpecificRoute}}if(e){return this.getEmptyParsedHash()}};o.getEmptyParsedHash=function(){return{semanticObject:undefined,action:undefined,contextRaw:undefined,params:{},appSpecificRoute:undefined}};o.stripLeadingHash=function(t){if(!t.startsWith("#")){return t}return t.substring(1)};o.ensureLeadingHash=function(t){if(!t){return"#"}if(t.startsWith("#")){return t}return`#${t}`};o.splitHash=function(t){const e=/^(?:#|)([\S\s]*?)(&\/[\S\s]*)?$/;if(t===undefined||t===null||t===""){return{}}const n=e.exec(t);const s=n[1];if(s!==""&&!i.test(s)){return{}}const a=n[2];if(s||a){return{shellPart:s,appSpecificRoute:a}}return{}};function u(t,e){if(e){return t+e}return t}function h(t,e){if(t){return t+e}return e}o._harmonizeShellHash=function(t){if(!t){return this.getEmptyParsedHash()}const e=n(t);if(t.target){if(typeof t.target.shellHash==="string"){const e=this.parseShellHash(u(t.target.shellHash,t.appSpecificRoute));return e||this.getEmptyParsedHash()}e.semanticObject=t.target.semanticObject;e.action=t.target.action;e.contextRaw=t.target.contextRaw}if(e.params){for(const t in e.params){const n=e.params[t];if(!Array.isArray(n)){e.params[t]=[n]}}}else{e.params={}}if(e.appStateKey){e.params["sap-xapp-state"]=[e.appStateKey]}const s=["semanticObject","action","contextRaw","params","appSpecificRoute"];for(const t in e){if(!s.includes(t)){delete e[t]}}return e};o.constructShellHash=function(t,n){const s=this._harmonizeShellHash(t);if(!s.semanticObject||!s.action){return h(n?"#":"",u("",s.appSpecificRoute))}let a=`${s.semanticObject}-${s.action.replace(/[?].*/,"")}`;if(s.contextRaw){a+=`~${s.contextRaw}`}let r="?";const c=Object.keys(s.params).sort();for(const t of c){const n=s.params[t];if(n.length>1){e.error("Array startup parameters violate the designed intent of the Unified Shell Intent, use only single-valued parameters!")}for(const e of n){a+=`${r+encodeURIComponent(t)}=${encodeURIComponent(e)}`;r="&"}}return h(n?"#":"",u(a,s.appSpecificRoute))};o.constructStableHash=function(t,e){const n=this._harmonizeShellHash(t);const s=this._removeNonIntentParameters(n.params);const a=Object.keys(s).sort().reduce((t,e)=>{const n=s[e];n.sort();t[e]=n;return t},{});return this.constructShellHash({semanticObject:n.semanticObject,action:n.action,contextRaw:n.contextRaw,params:a},e)};o.getBasicHash=function(t,e){const n=this.parseShellHash(t)||this.getEmptyParsedHash();return this.constructBasicHash(n,e)};o.constructBasicHash=function(t,e){const n=this._harmonizeShellHash(t);return this.constructShellHash({semanticObject:n.semanticObject,action:n.action},e)};o.compareHashes=function(t,e){const n=this.parseShellHash(t)||{};const s=this.parseShellHash(e)||{};return this.compareParsedHashes(n,s)};o.compareParsedHashes=function(t,e){return{sameIntent:this.haveSameIntent(t,e),sameParameters:this.haveSameIntentParameters(t,e),sameAppSpecificRoute:t.appSpecificRoute===e.appSpecificRoute}};o.haveSameIntent=function(t,e){t=t||{};e=e||{};return t.semanticObject===e.semanticObject&&t.action===e.action&&t.contextRaw===e.contextRaw};o.haveSameIntentParameters=function(t,e){t=t||{};e=e||{};const n=a({},t.params);const s=a({},e.params);return!this._parametersChanged(this._removeNonIntentParameters(n),this._removeNonIntentParameters(s))};o._removeNonIntentParameters=function(t){const e=r.getParameters({isIntentParameter:false});let n;if(t){for(let s=0;s<e.length;s++){n=e[s];if(t[n.name]){delete t[n.name]}}}return t||{}};o._parametersChanged=function(t,e){return!s(t,e)};o.isRootIntent=function(t){const e=c.getRootIntent();const n=this.parseShellHash(e,true);const s=this.compareParsedHashes(t,n);return s.sameIntent&&s.sameParameters};o.isEmptyHash=function(t){return this.constructShellHash(t)===""};return o});
//# sourceMappingURL=UrlParsing.js.map