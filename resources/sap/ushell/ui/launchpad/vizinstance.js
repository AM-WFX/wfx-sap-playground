// Copyright (c) 2009-2025 SAP SE, All Rights Reserved
sap.ui.define(["sap/m/ActionSheet","sap/m/GenericTile","sap/m/library","sap/m/Popover","sap/m/Text","sap/m/VBox","sap/ui/core/Component","sap/ui/core/Icon","sap/ui/core/Lib","sap/ui/events/PseudoEvents","sap/ushell/library","sap/ushell/resources","sap/ushell/ui/launchpad/VizInstanceBase","sap/ushell/ui/launchpad/VizInstanceRenderer"],(e,t,n,i,o,s,a,r,l,c,p,u,d,h)=>{"use strict";const f=n.PlacementType;const m=n.FrameType;const y=n.GenericTileScope;const g=n.LoadState;const b=p.DisplayFormat;const _=d.extend("sap.ushell.ui.launchpad.VizInstance",{metadata:{library:"sap.ushell",properties:{title:{type:"string",defaultValue:"",bindable:true},subtitle:{type:"string",defaultValue:"",bindable:true},height:{type:"int",defaultValue:2},width:{type:"int",defaultValue:2},info:{type:"string",defaultValue:"",bindable:true},icon:{type:"sap.ui.core.URI",defaultValue:"",bindable:true},numberUnit:{type:"string",defaultValue:"",bindable:true},state:{type:"sap.m.LoadState",defaultValue:g.Loaded,bindable:true},sizeBehavior:{type:"sap.m.TileSizeBehavior",defaultValue:undefined,bindable:true},editable:{type:"boolean",defaultValue:false,bindable:true},removable:{type:"boolean",defaultValue:true,bindable:true},clickable:{type:"boolean",defaultValue:true,bindable:true},active:{type:"boolean",defaultValue:false},targetURL:{type:"string"},indicatorDataSource:{type:"object",defaultValue:undefined},dataSource:{type:"object",defaultValue:undefined},keywords:{type:"string[]",defaultValue:[]},instantiationData:{type:"object",defaultValue:{}},contentProviderId:{type:"string",defaultValue:""},contentProviderLabel:{type:"string",defaultValue:""},vizConfig:{type:"object"},supportedDisplayFormats:{type:"sap.ushell.DisplayFormat[]",defaultValue:[b.Standard]},dataHelpId:{type:"string",defaultValue:""},vizRefId:{type:"string",defaultValue:""},displayFormat:{type:"sap.ushell.DisplayFormat",defaultValue:b.Standard},preview:{type:"boolean",defaultValue:false,bindable:true}},defaultAggregation:"tileActions",aggregations:{content:{type:"sap.ui.core.Control",multiple:false},tileActions:{type:"sap.m.Button",forwarding:{getter:"_getTileActionSheet",aggregation:"buttons"}}},events:{press:{parameters:{scope:{type:"sap.m.GenericTileScope"},action:{type:"string"}}},beforeActionSheetOpen:{},afterActionSheetClose:{}}},renderer:h});_.prototype.init=function(){this._pLoad=Promise.resolve();const e=new t({frameType:this._formatPlaceholderFrameType(this.getDisplayFormat()),state:this.getState()});this._disableTabindexOfInnerTile(e);this.setAggregation("content",e)};_.prototype.setDisplayFormat=function(e){this.setProperty("displayFormat",e);this._setSize();const t=this.getContent();if(t&&t.isA("sap.m.GenericTile")){t.setFrameType(this._formatPlaceholderFrameType(e))}return this};_.prototype.setState=function(e){this.setProperty("state",e);const t=this.getContent();if(t&&t.isA("sap.m.GenericTile")){t.setState(e)}return this};_.prototype.setSizeBehavior=function(e){this.setProperty("sizeBehavior",e);this.setTileSizeBehavior(e);return this};_.prototype.setEditable=function(e){this.setProperty("editable",e);this.setTileEditable(e);return this};_.prototype.setTileEditable=function(e){const t=e?y.ActionMore:y.Display;const n=this.getContent();if(n&&n.isA("sap.m.GenericTile")){n.setScope(t)}return this};_.prototype.setTileSizeBehavior=function(e){const t=this.getContent();if(t&&t.isA("sap.m.GenericTile")){t.setSizeBehavior(e)}return this};_.prototype._formatPlaceholderFrameType=function(e){this._setSize();switch(e){case b.Flat:return m.OneByHalf;case b.FlatWide:return m.TwoByHalf;case b.StandardWide:return m.TwoByOne;default:return m.OneByOne}};_.prototype.exit=function(){if(this._oActionModeButtonIconVBox){this._oActionModeButtonIconVBox.destroy()}if(this._oActionDivCenter){this._oActionDivCenter.destroy()}if(this._oActionSheet){this._oActionSheet.destroy()}if(this._oRemoveIconVBox){this._oRemoveIconVBox.destroy()}};_.prototype.getLayout=function(){return{columns:this.getWidth(),rows:this.getHeight()}};_.prototype.setContent=function(e){const t=this.getLayoutData();if(t&&t.isA("sap.f.GridContainerItemLayoutData")){t.setRows(this.getHeight());t.setColumns(this.getWidth())}const n=this.getDataHelpId();const i=this.getVizRefId();if(n){e.data("help-id",n,true);e.data("tile-id",n,true)}else{e.data("tile-id",i,true)}this._oInnerTile=null;this._disableTabindexOfContent(e);this.setAggregation("content",e)};_.prototype._disableTabindexOfContent=function(e){if(e){if(e.isA("sap.ui.core.ComponentContainer")){const t=e.getComponent();const n=a.getComponentById(t);if(n){this._disableTabindexOfContent(n.getRootControl())}}else if(e.isA("sap.m.FlexBox")){const t=e;const n=e.getItems()[0];t.addEventDelegate({onAfterRendering:this._disableTabindexOfContent.bind(this,n)});this._disableTabindexOfContent(n)}else if(e.isA("sap.ui.core.mvc.View")){this._disableTabindexOfContent(e.getContent()[0])}else if(e.isA("sap.cloudfnd.smartbusiness.lib.reusetiles.Singleton")){this._disableTabindexOfContent(e.getContent())}else if(e.isA("sap.m.SlideTile")||e.isA("sap.m.GenericTile")){this._disableTabindexOfInnerTile(e)}}};_.prototype._disableTabindexOfInnerTile=function(e){function t(){const e=this.getFocusDomRef();if(e&&e.getAttribute("tabindex")==="0"){if(e.tagName==="A"){e.setAttribute("tabindex","-1");e.tabindex=-1}else{e.removeAttribute("tabindex")}}}this._oInnerTile=e;t.call(e);e.addEventDelegate({onAfterRendering:t.bind(e)})};_.prototype._getTileActionSheet=function(){if(!this._oActionSheet){this._oActionSheet=new e({placement:f.VerticalPreferedBottom});this._oActionSheet.attachAfterClose(this.fireAfterActionSheetClose.bind(this))}return this._oActionSheet};_.prototype._openActionMenu=function(){if(this._oActionModeIcon){if(!this._getTileActionSheet().isOpen()){this.fireBeforeActionSheetOpen()}if(this.getTileActions().length===0){this._openNoActionsPopover();return}this._getTileActionSheet().openBy(this._oActionModeIcon)}};_.prototype.getFocusDomRef=function(){if(this.getEditable()){return this._oActionModeIcon&&this._oActionModeIcon.getFocusDomRef()}const e=this.getContent();let t=e.findAggregatedObjects(true,e=>e.isA("sap.m.GenericTile")||e.isA("sap.f.Card")||e.isA("sap.m.SlideTile"));if(t.length){return t[0].getFocusDomRef()}if(e.isA("sap.ui.core.ComponentContainer")){const n=e.getComponentInstance();if(n?.findAggregatedObjects){t=n.findAggregatedObjects(true,e=>e.isA("sap.m.GenericTile")||e.isA("sap.f.Card")||e.isA("sap.m.SlideTile"));if(t.length){return t[0].getFocusDomRef()}}}return e.getFocusDomRef()};_.prototype.onclick=function(e){if(this._preventDefault(e)){this.firePress({scope:"Display",action:"Press"})}else if(this._oRemoveIconVBox&&this._oRemoveIconVBox.getDomRef&&this._oRemoveIconVBox.getDomRef()&&this._oRemoveIconVBox.getDomRef().contains(e.target)){this.firePress({scope:"Actions",action:"Remove"})}else if(this.getEditable()){this._openActionMenu()}};_.prototype.onBeforeRendering=function(){const e=this.getDomRef();if(e){e.removeEventListener("keyup",this._fnKeyupHandler,true);e.removeEventListener("touchend",this._fnTouchendHandler,true);delete this._fnKeyupHandler;delete this._fnTouchendHandler;if(e.parentElement){e.parentElement.removeAttribute("aria-description");e.parentElement.removeAttribute("aria-labelledby");e.parentElement.removeEventListener("focusin",this._fnOnParentElementFocusInHandler,true);e.parentElement.removeEventListener("focusout",this._fnOnParentElementFocusOutHandler,true);e.parentElement.removeEventListener("keyup",this._fnOnParentElementKeyupHandler,true);delete this._fnOnParentElementFocusInHandler;delete this._fnOnParentElementFocusOutHandler;delete this._fnOnParentElementKeyupHandler}}};_.prototype._openNoActionsPopover=function(){const e=new o({text:u.i18n.getText("tileHasNoActions")});new i({placement:f.VerticalPreferedBottom,showHeader:false,ariaLabelledBy:e.getId(),content:e}).addStyleClass("sapUiContentPadding").openBy(this._oActionModeIcon)};_.prototype.onAfterRendering=function(){const e=this.getDomRef();this._fnKeyupHandler=this.onkeyup.bind(this);this._fnTouchendHandler=this.onclick.bind(this);e.addEventListener("keyup",this._fnKeyupHandler,true);e.addEventListener("touchend",this._fnTouchendHandler,true);if(e.parentElement){e.parentElement.setAttribute("aria-description",u.i18n.getText("VizInstance.AriaDescription.Link"));if(this._oInnerTile){const t=this._oInnerTile.getId();if(this._oInnerTile.isA("sap.m.SlideTile")){e.parentElement.setAttribute("aria-labelledby",`${t}-ariaText`);this._fnOnParentElementFocusInHandler=this._onParentElementFocusIn.bind(this,this._oInnerTile);this._fnOnParentElementFocusOutHandler=this._onParentElementFocusOut.bind(this,this._oInnerTile);this._fnOnParentElementKeyupHandler=this._onParentElementKeyup.bind(this,this._oInnerTile);e.parentElement.addEventListener("focusin",this._fnOnParentElementFocusInHandler,true);e.parentElement.addEventListener("focusout",this._fnOnParentElementFocusOutHandler,true);e.parentElement.addEventListener("keyup",this._fnOnParentElementKeyupHandler,true)}else{e.parentElement.setAttribute("aria-labelledby",t)}}}};_.prototype._onParentElementFocusIn=function(e){if(!e.mouseDown){const t=e.getDomRef();if(t&&t.classList.contains("sapMSTPauseIcon")){e.addStyleClass("sapUshellPaused");e.addStyleClass("sapMSTIconPressed");e.onmouseup()}}};_.prototype._onParentElementFocusOut=function(e){if(!e.mouseDown&&e.hasStyleClass("sapUshellPaused")){e.removeStyleClass("sapUshellPaused");e.addStyleClass("sapMSTIconPressed");e.onmouseup()}e.mouseDown=false};_.prototype._onParentElementKeyup=function(e,t){if(c.events.sapspace.fnCheck(t)){if(e.hasStyleClass("sapUshellPaused")){e.removeStyleClass("sapUshellPaused")}}if(t.key==="b"||t.key==="B"||t.key==="f"||t.key==="F"){this.getParent().focus()}};_.prototype.onkeyup=function(e){this._preventDefault(e);if(this.getEditable()){if(c.events.sapdelete.fnCheck(e)||c.events.sapbackspace.fnCheck(e)){this.firePress({scope:"Actions",action:"Remove"});return}if(c.events.sapspace.fnCheck(e)||c.events.sapenter.fnCheck(e)){this._openActionMenu()}}};_.prototype._preventDefault=function(e){if(this.getEditable()||!this.getClickable()){e.preventDefault();e.stopPropagation();e.stopImmediatePropagation();return false}return true};_.prototype.load=function(){return this._pLoad};_.prototype.loaded=function(){return this._pLoad};_.prototype._setSize=function(){const e={};switch(this.getDisplayFormat()){case b.Flat:e.width=2;e.height=1;break;case b.FlatWide:e.width=4;e.height=1;break;case b.StandardWide:e.width=4;e.height=2;break;default:e.width=2;e.height=2;break}this.setWidth(e.width);this.setHeight(e.height)};_.prototype.getAvailableDisplayFormats=function(){const e=this.getSupportedDisplayFormats();const t=this.getDisplayFormat();const n=e.filter(e=>e!==t);const i=n.indexOf("compact");const o=this.getTitle();const s=this.getTargetURL();if(i>-1&&(!o||!s)){n.splice(i,1)}return n};_.prototype._getRemoveIconVBox=function(){if(!this._oRemoveIconVBox){const e=l.getResourceBundleFor("sap.m");const t=new r({id:`${this.getId()}-action-remove`,alt:e.getText("GENERICTILE_ACTIONS_ARIA_TEXT"),decorative:false,noTabStop:true,src:"sap-icon://decline",tooltip:u.i18n.getText("removeButtonTitle")}).addStyleClass("sapUshellTileDeleteIconInnerClass sapMPointer");this._oRemoveIconVBox=new s({items:[t]}).addStyleClass("sapUshellTileDeleteIconOuterClass sapUshellTileDeleteClickArea sapMPointer");this._oRemoveIconVBox.setParent(this)}return this._oRemoveIconVBox};_.prototype._getActionModeButtonIconVBox=function(){if(!this._oActionModeButtonIconVBox){const e=l.getResourceBundleFor("sap.m");this._oActionModeIcon=new r({id:`${this.getId()}-action-more`,decorative:false,alt:e.getText("LIST_ITEM_NAVIGATION"),noTabStop:true,src:"sap-icon://overflow",tooltip:u.i18n.getText("configuration.category.tile_actions")}).addStyleClass("sapUshellTileActionIconDivBottomInner sapMPointer");const t=this._oActionModeIcon.onkeyup;this._oActionModeIcon.onkeyup=function(){t.apply(this._oActionModeIcon,arguments);this.onkeyup.apply(this,arguments)}.bind(this);this._oActionModeButtonIconVBox=new s({items:[this._oActionModeIcon]}).addStyleClass("sapUshellTileActionIconDivBottom sapMPointer");this._oActionModeButtonIconVBox.setParent(this)}return this._oActionModeButtonIconVBox};return _});
//# sourceMappingURL=VizInstance.js.map