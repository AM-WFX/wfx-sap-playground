// Copyright (c) 2009-2025 SAP SE, All Rights Reserved
sap.ui.define(["sap/m/library","sap/ui/core/Element","sap/ui/core/mvc/Controller","sap/ui/Device","sap/ui/model/json/JSONModel","sap/ui/thirdparty/hasher","sap/ushell/api/NewExperience","sap/ushell/Config","sap/ushell/EventHub","sap/ushell/library","sap/ushell/ui/shell/OverflowListItem","sap/ushell/Container","sap/ushell/state/modules/BackNavigation","sap/ushell/state/ShellModel","sap/ushell/state/StateManager"],(e,t,n,i,s,a,o,r,d,l,h,m,f,u,c)=>{"use strict";const g=e.ListType;const p=l.FloatingNumberType;const I=c.LaunchpadState;const E=c.Operation;const v="endItemsOverflowBtn";return n.extend("sap.ushell.renderer.shellHeader.ShellHeader",{onInit:function(){this.aDoables=[];this.aDoables.push(d.on("navigateBack").do(this.pressNavBackButton.bind(this)));this.aDoables.push(d.on("showEndItemOverflow").do(this.pressEndItemsOverflow.bind(this)));this.aDoables.push(d.on("navigateFromShellApplicationNavigationMenu").do(this.navigateFromShellApplicationNavigationMenu.bind(this)));this.aDoables.push(r.on("/core/shellHeader/homeUri").do(this._updateHomeUri.bind(this)));this._updateHomeUri(r.last("/core/shellHeader/homeUri"));this.aDoables.push(d.on("updateHeaderOverflowState").do(this._handleHeadEndItemsOverflow.bind(this)));i.media.attachHandler(this._handleHeadEndItemsOverflow,this,i.media.RANGESETS.SAP_STANDARD);this.oHeadEndBinding=u.getModel().bindList("/header/headEndItems");this.oHeadEndBinding.attachChange(this._handleHeadEndItemsOverflow,this);o.attachActiveChanged(this._handleHeadEndItemsOverflow,this)},_addHeadEndItem:function(e,t,n){this._updateHeadEndItems(e,E.Add,t,n)},_removeHeadEndItem:function(e,t,n){this._updateHeadEndItems(e,E.Remove,t,n)},_updateHeadEndItems:function(e,t,n,i){if(n){c.updateCurrentState("header.headEndItems",t,e)}else if(Array.isArray(i)&&i.length>0){c.updateBaseStates(i,"header.headEndItems",t,e)}else{c.updateAllBaseStates("header.headEndItems",t,e)}},_handleHeadEndItemsOverflow:function(){const e=u.getModel().getProperty("/header/headEndItems");const n=e.indexOf(v)>-1;const s=i.media.getCurrentRange(i.media.RANGESETS.SAP_STANDARD).name;if(s==="Phone"&&(o.isActive()||!n&&e.length>2)){this._addHeadEndItem(v,false,[I.Home,I.App]);this._moveNewExperienceToOverflow()}else if(s!=="Phone"&&n){const e=t.getElementById("headEndItemsOverflow");if(e){if(o.isActive()){const e=o.getOverflowItemControl();e.getParent()?.removeItem?.(e)}e.destroy()}this._removeHeadEndItem(v,false,[I.Home,I.App]);this._moveNewExperienceToShellHeader()}},_moveNewExperienceToOverflow:function(){if(o.isActive()){this._addHeadEndItem(o.getOverflowItemId(),false,[I.Home,I.App])}o.showInOverflow()},_moveNewExperienceToShellHeader:function(){if(o.isActive()){this._removeHeadEndItem(o.getOverflowItemId(),false,[I.Home,I.App])}o.showInShellHeader()},_updateHomeUri:function(e){const n=t.getElementById("shell-header");if(n){n.setHomeUri(e)}},pressNavBackButton:async function(){d.emit("showUserActionsMenu",false);f.navigateBack()},pressEndItemsOverflow:function(e){let n=t.getElementById("headEndItemsOverflow");const i=t.getElementById(e);let a=Promise.resolve();let o;if(!i){return}if(!n){a=new Promise((e,t)=>{sap.ui.require(["sap/ui/core/Fragment"],n=>{n.load({name:"sap.ushell.renderer.HeadEndItemsOverflowPopover",type:"XML",controller:this}).then(e).catch(t)},t)}).then(e=>{n=e;const i=t.getElementById("headEndItemsOverflowList");i.enhanceAccessibilityState=function(e,t){if(!e.isA("sap.ushell.ui.shell.OverflowListItem")){return t}if(e.getFloatingNumberType()!==p.None){t.describedby=e._oAriaDescribedbyText.getId()}return t};o=new s({headEndItems:u.getModel().getProperty("/header/headEndItems")});n.setModel(o)})}a.then(()=>{if(n.isOpen()){n.close()}else{if(t.getElementById("shellNotificationsPopover")){d.emit("showNotifications",false)}n.openBy(i)}})},headEndItemsOverflowItemFactory:function(e,n){if(o.isActive()&&n.getObject()===o.getOverflowItemId()){return o.getOverflowItemControl()}const i=t.getElementById(n.getObject());const s=i.getBindingPath("floatingNumber");const a=i.getText();const r=i.getTooltip();const d=new h({id:`${e}-${i.getId()}`,icon:i.getIcon(),iconInset:true,tooltip:r!==a?r:null,title:a,type:g.Active,floatingNumber:s?{path:s}:undefined,floatingNumberMaxValue:i.getFloatingNumberMaxValue(),floatingNumberType:i.getFloatingNumberType(),visible:i.getVisible(),press:function(){if(i){i.firePress();const e=i.getTarget();if(e){m.getServiceAsync("Navigation").then(t=>{t.navigate({target:{shellHash:e}})})}}const e=t.getElementById("headEndItemsOverflow");if(e.isOpen()){e.close()}}});if(i._oAriaLabel){d.addAriaLabelledBy(i._oAriaLabel)}if(s){d.setModel(i.getModel())}return d},destroyHeadEndItemsOverflow:function(e){if(o.isActive()){const e=o.getOverflowItemControl();e.getParent()?.removeItem?.(e)}e.getSource().destroy()},isHeadEndItemInOverflow:function(e){return e!=="ENDITEMSOVERFLOWBTN"&&!this.isHeadEndItemNotInOverflow(e)},isHeadEndItemNotInOverflow:function(e){const t=this.isHeadEndItemOverflow();const n=i.media.getCurrentRange(i.media.RANGESETS.SAP_STANDARD).name;if(e==="ENDITEMSOVERFLOWBTN"){return t}if(!t){return true}if(["USERACTIONSMENUHEADERBUTTON","BACKBTN"].indexOf(e)>-1){return true}if(n==="Phone"){return false}if(["SF","FLOATINGCONTAINERBUTTON"].indexOf(e)>-1){return true}if(n==="Desktop"&&e==="COPILOTBTN"){return true}return false},isHeadEndItemOverflow:function(){let e=0;let n;const s=u.getModel().getProperty("/header/headEndItems");if(s.indexOf("endItemsOverflowBtn")===-1){return false}const a=i.media.getCurrentRange(i.media.RANGESETS.SAP_STANDARD).name;let o=3;if(a==="Phone"){o=1}for(let i=0;i<s.length;i++){n=t.getElementById(s[i]);if(n&&n.getVisible()){e++}}if(t.getElementById("endItemsOverflowBtn").getVisible()){return e>o+1}return e>o},navigateFromShellApplicationNavigationMenu:function(e){if(a.getHash()!==e.substr(1)){d.emit("centerViewPort",Date.now());a.setHash(e)}const n=t.getElementById("shellAppTitle");if(n){n.close()}},onExit:function(){this.aDoables.forEach(e=>{e.off()});this.oHeadEndBinding.destroy();o.detachActiveChanged(this._handleHeadEndItemsOverflow,this)}})});
//# sourceMappingURL=ShellHeader.controller.js.map